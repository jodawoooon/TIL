# [JPA] 10. ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´

**ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°** ê³µë¶€ ê¸°ë¡

<br>

ëª©ì°¨
* ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì†Œê°œ
* JPQL
* Criteria
* QueryDSL
* Native SQL
* ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì‹¬í™”

<br>

## ğŸ“ 10.1 ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì†Œê°œ

í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰ í•„ìš”í•¨

### ğŸ’­ JPQL
* í…Œì´ë¸”ì´ ì•„ë‹Œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” **ê°ì²´ì§€í–¥ ì¿¼ë¦¬**
* SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • DB SQLì— ì˜ì¡´ X

<br>

ì˜ˆì œ - íšŒì›ì´ë¦„ì´ KIMì¸ ì—”í‹°í‹° ì¡°íšŒ
```java
List<Member> memberList = em.createQuery(
	"select m from Member m where m.userName like '%KIM%'", Member.class
).getResultList();
            
            
Hibernate: 
    /* select
        m 
    from
        Member m 
    where
        m.userName like '%KIM%' */ select
            member0_.MEMBER_ID as MEMBER_I1_6_,
            member0_.city as city2_6_,
            member0_.street as street3_6_,
            member0_.zipcode as zipcode4_6_,
            member0_.userName as userName5_6_ 
        from
            Member member0_ 
        where
            member0_.userName like '%KIM%'
```

<br>

### ğŸ’­ Criteria ì¿¼ë¦¬

JPQLì„ ìƒì„±í•˜ëŠ” ë¹Œë” í´ë˜ìŠ¤
ë¬¸ìê°€ ì•„ë‹Œ í”„ë¡œê·¸ë˜ë° ì½”ë“œë¡œ JPQLì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
- ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ ë°œê²¬ 
- IDEë¥¼ ì‚¬ìš©í•˜ë©´ ì½”ë“œ ìë™ì™„ì„± ì§€ì›
- ë™ì  ì¿¼ë¦¬ ì‘ì„± í¸í•¨

```java
//Criteria ì‚¬ìš©ì¤€ë¹„
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> query = cb.createQuery(Member.class);
            
//Root í´ë˜ìŠ¤
Root<Member> m = query.from(Member.class);

//ì¿¼ë¦¬ ìƒì„±
CriteriaQuery<Member> cq = query.select(m).where(cb.equal(m.get("userName"), "KIM"));
List<Member> memberList = em.createQuery(cq).getResultList();



Hibernate: 
    /* select
        generatedAlias0 
    from
        Member as generatedAlias0 
    where
        generatedAlias0.userName=:param0 */ select
            member0_.MEMBER_ID as MEMBER_I1_6_,
            member0_.city as city2_6_,
            member0_.street as street3_6_,
            member0_.zipcode as zipcode4_6_,
            member0_.userName as userName5_6_ 
        from
            Member member0_ 
        where
            member0_.userName=?
```

ì¥ì ì€ ë§ì§€ë§Œ** ì‹¤ë¬´ì—ì„  ì•ˆì”€ **
ë³µì¡í•´ì„œ ì‹¤ìš©ì„±ì´ ì—†ê³  ìš´ì˜í•˜ê¸° ì–´ë ¤ì›€

<br>

### ğŸ’­ QueryDSL 

Criteriaì²˜ëŸ¼ JPQL ë¹Œë” ì—­í• ì„ í•¨
ì½”ë“œ ê¸°ë°˜ì´ë©´ì„œ ë‹¨ìˆœí•˜ê³  ì‚¬ìš©í•˜ê¸° ì‰½ë‹¤
ì»´íŒŒì¼ ì‹œì ì— ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŒ

â€¢ ë™ì ì¿¼ë¦¬ ì‘ì„± í¸ë¦¬í•¨
â€¢ ë‹¨ìˆœí•˜ê³  ì‰¬ì›€
â€¢ ì‹¤ë¬´ ì‚¬ìš© ê¶Œì¥


<br>


### ğŸ’­ ë„¤ì´í‹°ë¸Œ SQL

JPAê°€ ì œê³µí•˜ëŠ” SQLì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥
íŠ¹ì • DBì— ì˜ì¡´í•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•Œ í•„ìš”
í‘œì¤€í™” ë˜ì–´ ìˆì§€ ì•Šì€ ê²ƒë“¤ì€ JPQLì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. ë˜í•œ SQLì€ ì§€ì›í•˜ì§€ë§Œ JPQLì´ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ë„ ìˆë‹¤.

=> ë„¤ì´í‹°ë¸Œ SQL

ë‹¨ì ì€ íŠ¹ì • DBì— ì˜ì¡´ì ì´ë¯€ë¡œ DBë¥¼ ë³€ê²½í•˜ë©´ ë„¤ì´í‹°ë¸Œ SQLë„ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

<br>

### ğŸ’­ JDBC ì§ì ‘ ì‚¬ìš©, SpringJdbcTemplate ë“±

JPAì™€ í•¨ê»˜ JDBC ì»¤ë„¥ì…˜ì„ ì§ì ‘ ì‚¬ìš©í•˜ê±°ë‚˜, ìŠ¤í”„ë§
JdbcTemplate, MyBatis ë“± í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤


<br>

#### flushê°€ ë˜ëŠ” ì‹œì ì€ commitë  ë•Œì™€ queryê°€ ë‚ ì•„ê°ˆ ë•Œì´ë‹¤.

`flush`ëŠ” commitë˜ê¸° ì§ì „ì—ë„ í˜¸ì¶œë˜ì§€ë§Œ emì„ í†µí•´ JPQL queryê°€ ë‚ ì•„ê°ˆ ë•Œë„ ì§ì „ì— `flush`ê°€ ëœë‹¤ (auto)
**JPA ê´€ë ¨ëœ ê¸°ìˆ ì„ ì“¸ ë•ŒëŠ” í¬ê²Œ ë¬¸ì œê°€ ì•ˆëœë‹¤.**

<br>

ë‹¤ë§Œ DB ì»¤ë„¥ì…˜ì„ ë”°ë¡œ ì–»ì–´ì™€ì„œ JPAë¥¼ ìš°íšŒí•´ì„œ DBì— ì ‘ê·¼í•  ê²½ìš°ì—ëŠ” ë¬¸ì œê°€ ëœë‹¤. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ DBë¥¼ ë¶ˆì¼ì¹˜ ìƒíƒœë¡œ ë§Œë“¤ì–´ì„œ ë°ì´í„° ë¬´ê²°ì„±ì„ í›¼ì†í•  ìˆ˜ ìˆë‹¤.

JDBCë‚˜ MyBatisë¥¼ JPAì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë ¤ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì ì ˆí•œ ì‹œì ì— ê°•ì œë¡œ í”ŒëŸ¬ì‹œ í•´ì•¼í•œë‹¤.

JPA ìš°íšŒí•´ì„œ SQL ì‹¤í–‰í•˜ê¸° ì§ì „ì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ `flush`í•´ì„œ **DBì™€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë™ê¸°í™”**í•œë‹¤.

<br><br>